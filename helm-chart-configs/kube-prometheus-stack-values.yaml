# Main chart kube-prometheus-stack values: https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/values.yaml
prometheus:
  ingress:
    enabled: true
    hosts:
    - l02-prometheus.cloudnativeapps.cloud
  prometheusSpec:
    serviceMonitorSelectorNilUsesHelmValues: false

# Sub-chart Grafana values: https://github.com/grafana/helm-charts/blob/main/charts/grafana/values.yaml
grafana:
  enabled: true
  adminPassword: Grafana1!
  ingress:
    enabled: true
    hosts:
    - l02-grafana.cloudnativeapps.cloud
  sidecar:
    dashboards:
      enabled: true
      SCProvider: false
      folder: /var/lib/grafana/dashboards
      folderAnnotation: grafana_folder
      annotations:
        grafana_folder: default
  dashboardProviders:
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
      - name: default
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/default
      - name: nvidia
        orgId: 1
        folder: NVIDIA
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/nvidia
  dashboards:
    nvidia:
      nvidia-gpu-dashboard:
        json: |
          {"__elements":[],"__requires":[{"type":"panel","id":"gauge","name":"Gauge","version":""},{"type":"grafana","id":"grafana","name":"Grafana","version":"9.0.1"},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"},{"type":"panel","id":"table","name":"Table","version":""},{"type":"panel","id":"timeseries","name":"Time series","version":""}],"annotations":{"list":[{"builtIn":1,"datasource":{"type":"datasource","uid":"grafana"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"description":"GPU dashboard for nvidia metrics ","editable":true,"fiscalYearStartMonth":0,"gnetId":18288,"graphTooltip":1,"id":null,"iteration":1678972197990,"links":[],"liveNow":false,"panels":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"max":1,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":0.8}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":6,"w":3,"x":0,"y":0},"id":22,"links":[],"maxDataPoints":100,"options":{"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true,"text":{}},"pluginVersion":"9.0.1","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"sum(avg(DCGM_FI_PROF_GR_ENGINE_ACTIVE{instance=~\"$instance\"}) by (instance, gpu)) / count(count(DCGM_FI_PROF_GR_ENGINE_ACTIVE{instance=~\"$instance\"}) by (instance, device))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"GPU Utilization","type":"gauge"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":6,"w":3,"x":3,"y":0},"id":23,"links":[],"maxDataPoints":100,"options":{"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true,"text":{}},"pluginVersion":"9.0.1","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"sum(DCGM_FI_DEV_MEM_COPY_UTIL{instance=~\"$instance\", gpu=~\"$gpu\"}) / count(DCGM_FI_PROF_GR_ENGINE_ACTIVE{GPU_I_PROFILE=\"\",instance=~\"$instance\", gpu=~\"$gpu\"})","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"GPU Memory Utilization","type":"gauge"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":0,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"links":[],"mappings":[],"max":1,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":9,"w":9,"x":6,"y":0},"id":10,"links":[],"options":{"legend":{"calcs":[],"displayMode":"hidden","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"8.2.3","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"avg(DCGM_FI_PROF_GR_ENGINE_ACTIVE{GPU_I_PROFILE=\"\",instance=~\"$instance\", gpu=~\"$gpu\"}) BY (instance, gpu)","hide":false,"interval":"","legendFormat":"{{instance}}-full{{gpu}}","refId":"A"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"AVG(DCGM_FI_PROF_GR_ENGINE_ACTIVE{GPU_I_PROFILE!=\"\",instance=~\"$instance\", gpu=~\"$gpu\", GPU_I_PROFILE=~\"$mig\"}) BY (instance, gpu)","hide":false,"interval":"","legendFormat":"{{instance}}-mig{{gpu}}","refId":"B"}],"title":"GPU Utilization","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":0,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"links":[],"mappings":[],"max":1,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":9,"w":9,"x":15,"y":0},"id":28,"links":[],"options":{"legend":{"calcs":[],"displayMode":"hidden","placement":"bottom"},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.2.3","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":" AVG(DCGM_FI_PROF_PIPE_TENSOR_ACTIVE{instance=~\"$instance\", gpu=~\"$gpu\"}) BY (instance, gpu)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{instance}}-gpu{{gpu}}","refId":"A"}],"title":"Tensor Core Utilization","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","displayMode":"auto","inspect":false,"minWidth":50},"mappings":[{"options":{"match":"null","result":{"index":0,"text":"0"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[{"matcher":{"id":"byName","options":"Use [50%]"},"properties":[{"id":"custom.width","value":80}]},{"matcher":{"id":"byName","options":"Allocatable"},"properties":[{"id":"custom.width","value":90}]}]},"gridPos":{"h":6,"w":6,"x":0,"y":6},"id":25,"links":[],"maxDataPoints":100,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"frameIndex":0,"showHeader":true,"sortBy":[]},"pluginVersion":"9.0.1","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"count(label_replace(DCGM_FI_PROF_GR_ENGINE_ACTIVE{instance=~\"$instance\",GPU_I_PROFILE!=\"\"}, \"GPU\",\"$1\",\"GPU_I_PROFILE\",\"(.*)\")) by (instance,GPU)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"{{ GPU }}","refId":"A"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"count(label_replace(DCGM_FI_PROF_GR_ENGINE_ACTIVE{instance=~\"$instance\",GPU_I_PROFILE!=\"\"} >= 0.5, \"GPU\",\"$1\",\"GPU_I_PROFILE\",\"(.*)\")) by (instance,GPU)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"{{ GPU }}","refId":"B"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"count(label_replace(DCGM_FI_PROF_GR_ENGINE_ACTIVE{instance=~\"$instance\",GPU_I_PROFILE=\"\"}, \"GPU\",\"$1\",\"modelName\",\"(.*)\")) by (GPU)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"{{ GPU }}","refId":"C"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"count(label_replace(DCGM_FI_PROF_GR_ENGINE_ACTIVE{instance=~\"$instance\",GPU_I_PROFILE=\"\"} >= 0.5, \"GPU\",\"$1\",\"modelName\",\"(.*)\")) by (GPU)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"{{ GPU }}","refId":"D"}],"title":"# GPUs / MIGs","transformations":[{"id":"seriesToColumns","options":{"byField":"GPU"}},{"id":"organize","options":{"excludeByName":{"Time":true,"Time 1":true,"Time 2":true,"Time 3":true,"Time 4":true,"instance":true},"indexByName":{},"renameByName":{"Value #A":"Capacity_aux","Value #B":"Use","Value #C":"Capacity_aux","Value #D":"Use","Value #E":"USe [>=50%]"}}},{"id":"calculateField","options":{"alias":"Allocatable","mode":"reduceRow","reduce":{"include":["Capacity_aux"],"reducer":"sum"}}},{"id":"calculateField","options":{"alias":"Use [50%]","mode":"reduceRow","reduce":{"include":["Use"],"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{"Capacity":false,"Capacity_aux":true,"Use":true},"indexByName":{},"renameByName":{}}}],"type":"table"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":9,"w":9,"x":6,"y":9},"id":11,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom"},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.2.3","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":" AVG(DCGM_FI_DEV_MEM_COPY_UTIL{instance=~\"$instance\", gpu=~\"$gpu\"}) BY (instance, gpu)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{instance}}-gpu{{gpu}}","refId":"A"}],"title":"Memory Utilization","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":0,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":9,"w":9,"x":15,"y":9},"id":12,"links":[],"options":{"legend":{"calcs":["mean","lastNotNull","max"],"displayMode":"hidden","placement":"right"},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.2.3","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":" AVG(DCGM_FI_DEV_FAN_SPEED{instance=~\"$instance\", gpu=~\"$gpu\"}) BY (instance, device)","format":"time_series","instant":false,"interval":"","intervalFactor":1,"legendFormat":"{{ instance}}-{{ device }}","refId":"A"}],"title":"Fan Speed","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","displayMode":"auto","inspect":false},"mappings":[{"options":{"match":"null","result":{"index":0,"text":"0"}},"type":"special"},{"options":{"pattern":"nvidia_com_(.*)_shared","result":{"index":1,"text":"$1.shared"}},"type":"regex"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[{"matcher":{"id":"byName","options":"Requests"},"properties":[{"id":"custom.width","value":75}]},{"matcher":{"id":"byName","options":"Allocatable"},"properties":[{"id":"custom.width","value":90}]}]},"gridPos":{"h":6,"w":6,"x":0,"y":12},"id":31,"links":[],"maxDataPoints":100,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"frameIndex":0,"showHeader":true,"sortBy":[]},"pluginVersion":"9.0.1","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"editorMode":"code","exemplar":true,"expr":"sum(kube_node_status_allocatable{node=~\"$instance\",resource=~\"nvidia_com_.+_shared\"}) by (node,resource)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"__auto","refId":"A"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"editorMode":"code","exemplar":true,"expr":"sum(kube_pod_container_resource_limits{node=~\"$instance\",resource=~\"nvidia_com_.+_shared\"}) by (node,resource)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"__auto","refId":"B"}],"title":"# Timeslicing","transformations":[{"id":"seriesToColumns","options":{"byField":"resource"}},{"id":"organize","options":{"excludeByName":{"Time":true,"Time 1":true,"Time 2":true,"Time 3":true,"Time 4":true,"Value":false,"__name__":true,"container":true,"endpoint":true,"instance":true,"job":true,"namespace":true,"node":true,"pod":true,"service":true,"unit":true},"indexByName":{},"renameByName":{"Value #A":"Allocatable","Value #B":"Requests","Value #C":"Capacity","Value #D":"Use [50%]","Value #E":"USe [>=50%]"}}}],"type":"table"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"celsius"},"overrides":[]},"gridPos":{"h":7,"w":13,"x":0,"y":18},"id":2,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom"},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.2.3","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"AVG(DCGM_FI_DEV_GPU_TEMP{instance=~\"$instance\", gpu=~\"$gpu\"}) BY (instance, gpu)","format":"time_series","instant":false,"interval":"","intervalFactor":1,"legendFormat":"{{instance}}-gpu{{gpu}}","refId":"A"}],"thresholds":[{"colorMode":"critical","op":"gt","value":90,"visible":true}],"title":"GPU Temperature","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":40,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"normal"},"thresholdsStyle":{"mode":"off"}},"links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"watt"},"overrides":[]},"gridPos":{"h":7,"w":11,"x":13,"y":18},"id":20,"links":[],"options":{"legend":{"calcs":["mean","lastNotNull"],"displayMode":"hidden","placement":"right"},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.2.3","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"AVG(DCGM_FI_DEV_POWER_USAGE{instance=~\"$instance\", gpu=~\"$gpu\"}) BY (instance, gpu)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{instance}}-gpu{{gpu}}","refId":"A"}],"title":"Power Usage","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":0,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"Bps"},"overrides":[]},"gridPos":{"h":7,"w":12,"x":0,"y":25},"id":29,"links":[],"options":{"legend":{"calcs":[],"displayMode":"hidden","placement":"bottom"},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.2.3","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"-DCGM_FI_PROF_PCIE_TX_BYTES{instance=~\"$instance\", gpu=~\"$gpu\"}","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{instance}}-gpu{{gpu}}-Tx","refId":"A"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"DCGM_FI_PROF_PCIE_RX_BYTES{instance=~\"$instance\", gpu=~\"$gpu\"}","format":"time_series","hide":false,"interval":"","intervalFactor":1,"legendFormat":"{{instance}}-gpu{{gpu}}-Rx","refId":"B"}],"title":"PCIe Tx/Rx","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"Prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":0,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"links":[],"mappings":[],"max":1,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":7,"w":12,"x":12,"y":25},"id":30,"links":[],"options":{"legend":{"calcs":[],"displayMode":"hidden","placement":"bottom"},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.2.3","targets":[{"datasource":{"type":"prometheus","uid":"Prometheus"},"exemplar":true,"expr":"AVG(DCGM_FI_PROF_DRAM_ACTIVE{instance=~\"$instance\", gpu=~\"$gpu\"}) BY (instance, gpu)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{instance}}-gpu{{gpu}}","refId":"A"}],"title":"Cycles Memory Interface","type":"timeseries"}],"refresh":false,"schemaVersion":36,"style":"dark","tags":["gpu","kubernetes-mixin"],"templating":{"list":[{"allValue":".*","current":{},"datasource":{"type":"prometheus","uid":"Prometheus"},"definition":"label_values(DCGM_FI_PROF_GR_ENGINE_ACTIVE, instance)","hide":0,"includeAll":true,"label":"","multi":false,"name":"instance","options":[],"query":{"query":"label_values(DCGM_FI_PROF_GR_ENGINE_ACTIVE, instance)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":2,"type":"query"},{"allValue":".*","current":{},"datasource":{"type":"prometheus","uid":"Prometheus"},"definition":"label_values(DCGM_FI_PROF_GR_ENGINE_ACTIVE, gpu)","hide":0,"includeAll":true,"multi":false,"name":"gpu","options":[],"query":{"query":"label_values(DCGM_FI_PROF_GR_ENGINE_ACTIVE, gpu)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"type":"query"},{"allValue":".*","current":{},"datasource":{"type":"prometheus","uid":"Prometheus"},"definition":"label_values(DCGM_FI_PROF_GR_ENGINE_ACTIVE, GPU_I_PROFILE)","hide":0,"includeAll":true,"multi":true,"name":"mig","options":[],"query":{"query":"label_values(DCGM_FI_PROF_GR_ENGINE_ACTIVE, GPU_I_PROFILE)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"type":"query"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{"refresh_intervals":["30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Nvidia GPU","uid":"fnvhnzGmk","version":1,"weekStart":""}
      nvidia-dcgm-exporter-dashboard:
        json: |
          {"__requires":[{"type":"panel","id":"gauge","name":"Gauge","version":""},{"type":"grafana","id":"grafana","name":"Grafana","version":"6.7.3"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"}],"annotations":{"list":[{"$$hashKey":"object:192","builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"description":"This dashboard is to display the metrics from DCGM Exporter on a Kubernetes (1.13+) cluster","editable":true,"gnetId":12239,"graphTooltip":0,"id":null,"iteration":1588401887165,"links":[],"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","fill":1,"fillGradient":0,"gridPos":{"h":8,"w":18,"x":0,"y":0},"hiddenSeries":false,"id":12,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"DCGM_FI_DEV_GPU_TEMP{instance=~\"${instance}\", gpu=~\"${gpu}\"}","instant":false,"interval":"","legendFormat":"GPU {{gpu}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GPU Temperature","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"celsius","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":"Prometheus","gridPos":{"h":8,"w":6,"x":18,"y":0},"id":14,"options":{"fieldOptions":{"calcs":["mean"],"defaults":{"color":{"mode":"thresholds"},"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"#EAB839","value":83},{"color":"red","value":87}]},"unit":"celsius"},"overrides":[],"values":false},"orientation":"auto","showThresholdLabels":false,"showThresholdMarkers":true},"pluginVersion":"6.7.3","targets":[{"expr":"avg(DCGM_FI_DEV_GPU_TEMP{instance=~\"${instance}\", gpu=~\"${gpu}\"})","interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"GPU Avg. Temp","type":"gauge"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","fill":1,"fillGradient":0,"gridPos":{"h":8,"w":18,"x":0,"y":8},"hiddenSeries":false,"id":10,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pluginVersion":"6.5.2","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"DCGM_FI_DEV_POWER_USAGE{instance=~\"${instance}\", gpu=~\"${gpu}\"}","interval":"","legendFormat":"GPU {{gpu}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GPU Power Usage","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"watt","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"cacheTimeout":null,"datasource":"Prometheus","gridPos":{"h":8,"w":6,"x":18,"y":8},"id":16,"links":[],"options":{"fieldOptions":{"calcs":["sum"],"defaults":{"color":{"mode":"thresholds"},"mappings":[],"max":2400,"min":0,"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"#EAB839","value":1800},{"color":"red","value":2200}]},"unit":"watt"},"overrides":[],"values":false},"orientation":"horizontal","showThresholdLabels":false,"showThresholdMarkers":true},"pluginVersion":"6.7.3","targets":[{"expr":"sum(DCGM_FI_DEV_POWER_USAGE{instance=~\"${instance}\", gpu=~\"${gpu}\"})","interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"GPU Power Total","type":"gauge"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":0,"y":16},"hiddenSeries":false,"id":2,"interval":"","legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"DCGM_FI_DEV_SM_CLOCK{instance=~\"${instance}\", gpu=~\"${gpu}\"} * 1000000","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"GPU {{gpu}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GPU SM Clocks","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"hertz","label":"","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":0,"y":24},"hiddenSeries":false,"id":6,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"DCGM_FI_DEV_GPU_UTIL{instance=~\"${instance}\", gpu=~\"${gpu}\"}","interval":"","legendFormat":"GPU {{gpu}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GPU Utilization","tooltip":{"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":"100","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":0,"y":32},"hiddenSeries":false,"id":18,"legend":{"avg":true,"current":false,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"DCGM_FI_DEV_FB_USED{instance=~\"${instance}\", gpu=~\"${gpu}\"}","interval":"","legendFormat":"GPU {{gpu}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GPU Framebuffer Mem Used","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decmbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":0,"y":24},"hiddenSeries":false,"id":4,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"DCGM_FI_PROF_PIPE_TENSOR_ACTIVE{instance=~\"${instance}\", gpu=~\"${gpu}\"}","interval":"","legendFormat":"GPU {{gpu}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Tensor Core Utilization","tooltip":{"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":"1","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":false,"schemaVersion":22,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{},"datasource":"Prometheus","definition":"label_values(DCGM_FI_DEV_GPU_TEMP, instance)","hide":0,"includeAll":false,"label":null,"multi":true,"name":"instance","options":[],"query":"label_values(DCGM_FI_DEV_GPU_TEMP, instance)","refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"Prometheus","definition":"label_values(gpu)","hide":0,"includeAll":true,"index":-1,"label":null,"multi":true,"name":"gpu","options":[],"query":"label_values(gpu)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-15m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"]},"timezone":"","title":"NVIDIA DCGM Exporter Dashboard","uid":"Oxed_c6Wz","variables":{"list":[]},"version":1}

alertmanager:
  enabled: false
kubeControllerManager:
  enabled: false
kubeProxy:
  enabled: false
kubeScheduler:
  enabled: false
kubeEtcd:
  enabled: false